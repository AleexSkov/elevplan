@page "/elevplaner"
@inject HttpClient Http
@using Core.Models

<h3>Elevplaner</h3>

@if (elevplaner == null)
{
    <p>Indlæser elevplaner...</p>
}
else if (!elevplaner.Any())
{
    <p>Ingen elevplaner fundet.</p>
}
else
{
    @foreach (var plan in elevplaner)
    {
        <div class="card mb-4 p-3">
            <h4>@plan.ElevNavn (@plan.ElevId)</h4>
            <p><strong>Skole:</strong> @plan.Skole | <strong>Aftaleform:</strong> @plan.Aftaleform</p>
            <p><strong>Oprettet:</strong> @plan.OprettetDato.ToShortDateString() | <strong>Opdateret:</strong> @plan.OpdateretDato.ToShortDateString()</p>

            @if (plan.Praktikperioder != null && plan.Praktikperioder.Any())
            {
                <h5 class="mt-3">Praktikperioder</h5>
                @foreach (var periode in plan.Praktikperioder)
                {
                    <div class="ms-3 mb-3 p-2 border-start border-4">
                        <p><strong>Periode @periode.PeriodeNummer</strong> – @periode.VarighedUger uger</p>
                        <p><strong>Skoleperiode:</strong>
                            @periode.Skoleperiode?.StartDato?.ToShortDateString()
                            –
                            @periode.Skoleperiode?.SlutDato?.ToShortDateString()
                            (@periode.Skoleperiode?.VarighedUger uger)
                        </p>

                        @if (periode.Opgaver != null && periode.Opgaver.Any())
                        {
                            <h6>Opgaver</h6>
                            <ul>
                                @foreach (var opgave in periode.Opgaver)
                                {
                                    <li>
                                        <strong>@opgave.Kategori:</strong> @opgave.Beskrivelse<br />
                                        <em>@opgave.Tidslinje</em><br />
                                        <span>Ansvarlig: @opgave.Ansvarlig | Initiator: @opgave.Initiator</span><br />
                                        <span>Status: @(opgave.Gennemført ? "✔️ Gennemført" : "❌ Ikke gennemført")</span>
                                    </li>
                                }
                            </ul>
                        }
                        else
                        {
                            <p><em>Ingen opgaver registreret.</em></p>
                        }
                    </div>
                }
            }
            else
            {
                <p><em>Ingen praktikperioder registreret.</em></p>
            }
        </div>
    }
}

@code {
    private List<Elevplan>? elevplaner;

    protected override async Task OnInitializedAsync()
    {
        elevplaner = await Http.GetFromJsonAsync<List<Elevplan>>("api/elevplan");
    }
}
