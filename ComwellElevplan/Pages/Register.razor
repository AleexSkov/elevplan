@page "/register"
@using Core.Models
@inject HttpClient Http

<h3>Opret bruger</h3>

<EditForm Model="newUser" OnValidSubmit="HandleRegister">
    <DataAnnotationsValidator />
    <ValidationSummary />

    <div class="mb-3">
        <label>Email</label>
        <InputText @bind-Value="newUser.Email" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Navn</label>
        <InputText @bind-Value="newUser.Name" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Rolle</label>
        <InputText @bind-Value="newUser.Role" class="form-control" />
    </div>

    <div class="mb-3">
        <label>Adgangskode</label>
        <InputText @bind-Value="password" class="form-control" type="password" />
    </div>

    <button type="submit" class="btn btn-primary">Opret bruger</button>

    @if (!string.IsNullOrEmpty(message))
    {
        <p class="mt-3 alert alert-info">@message</p>
    }
</EditForm>


@code {
    private AppUser newUser = new();
    private string password = "";
    private string? message;

    private async Task HandleRegister()
    {
        newUser.PasswordHash = password; // OBS: hash i rigtig l√∏sning!
        newUser.CreatedAt = DateTime.UtcNow;

        var response = await Http.PostAsJsonAsync("http://localhost:5102/api/auth/register", newUser);
        if (response.IsSuccessStatusCode)
        {
            message = "Bruger oprettet!";
            newUser = new();
            password = "";
        }
        else
        {
            message = "Fejl: " + await response.Content.ReadAsStringAsync();
        }
    }

   /* public class AppUser
    {
        public string Email { get; set; } = string.Empty;
        public string Role { get; set; } = string.Empty;
        public string PasswordHash { get; set; } = string.Empty;
        public bool MustChangePassword { get; set; } = true;
        public string? Name { get; set; }
        public DateTime CreatedAt { get; set; }
    }*/
}